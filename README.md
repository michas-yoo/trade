# Анализатор акций (Nuxt 3 + TypeScript)

Веб‑приложение для анализа акций с использованием выбранной стратегии (пока SMA/EMA), визуализацией данных цены акции
и рекомендацией к действию. Приложение написано в стиле Чистой архитектуры.

Сбор данных происходит через порт рыночных данных и адаптер под API Т‑Инвестиций, после чего данные
преобразуются в доменные сущности «свечей» и обрабатываются стратегиями. Результат анализа включает торговый сигнал и
исходные свечи, на основе которых можно построить график и вычислить период данных в днях.

Основной стек:

- Nuxt 3, Vue 3, TypeScript
- Tailwind CSS
- ApexCharts (через `vue3-apexcharts`) для свечных графиков

## Пример работы

[![Смотреть демо на YouTube](https://img.youtube.com/vi/HigLConh1vw/hqdefault.jpg)](https://www.youtube.com/watch?v=HigLConh1vw)

## Быстрый старт

1. Установите зависимости:

```bash
npm install
```

2. Запустите dev‑сервер на http://localhost:3000:

```bash
npm run dev
```

3. Сборка и предпросмотр production‑версии:

```bash
npm run build
npm run preview
```

## Архитектура: слои и чистая архитектура

Проект организован по принципам Чистой архитектуры. Внутри каталога `app/core` выделены слои:

- `domain` — бизнес‑сущности, доменные типы и алгоритмы стратегий;
- `application` — прикладные сценарии (use‑cases), объединяющие доменные операции и работу с портами;
- `ports` — интерфейсы (абстракции) для внешних источников данных;
- `infrastructure` — конкретные адаптеры под внешние сервисы и вспомогательные утилиты (в т.ч. преобразователи данных и
  мапперы для графиков).

UI слой (`app/components`, `app/pages`) зависит от `application/domain`, но не наоборот. Инфраструктура реализует
абстракции из `ports` и «подсовывается» в `application`.

Детали реализации можно посмотреть в соответствующих файлах, а ниже описаны общий поток данных и контракты.

## Data Flow (поток данных)

1. Пользователь задаёт параметры в `TradingForm` и жмёт «Получить результат».
2. `TradingForm` вызывает `getSignalForParams` (application), передавая адаптер `TBankApiAdapter` и параметры (`figi`,
   `from`).
3. `TBankApiAdapter` (infrastructure) запрашивает свечи, маппит ответ к доменным `Candles`.
4. `getSignalForParams` передаёт `Candles` и `TradeConfig` в `getSignalForCandles`.
5. `getSignalForCandles` выбирает стратегию (`SMA`/`EMA` и т.п.), рассчитывает `Signal` и возвращает
   `TradePrediction = { signal, candles }`.
6. В `index.vue` полученный `TradePrediction`:
   - сохраняется в `result` (часть `signal`),
   - свечи маппятся через `mapCandlesToApexCharts` в `graphData`,
   - рассчитывается `daysSpan = ceil(|last.time - first.time| / 86_400_000)` (минимум 1 день при наличии свечей).
7. `AnalysisResult` отображает информацию и управляет показом графика; `CandlesGraph` строит свечной график по
   `graphData`.

Таким образом, UI полностью отделён от деталей получения данных и расчёта — он принимает готовый результат use‑case'ов.

## Типы и контракты

- `TradePrediction` (application/domain):

  ```ts
  type TradePrediction = {
    signal: Signal;
    candles: Candles;
  };
  ```

  Единый результат анализа, используемый UI.

- `MarketDataPort` (ports):
  - Контракт получения свечей по параметрам (`figi`, `from`, и др. при необходимости).
  - Реализации адаптеров размещаются в `core/infrastructure`.

- Мапперы:
  - `mapTBankResponseToCandles` — внешняя → доменная модель;
  - `mapCandlesToApexCharts` — доменная модель → формат графика.

## Конфигурация и расширение

- Добавление новой стратегии:
  1. Реализуйте функцию `get<YourStrategy>Result` в `core/domain/strategies/`.
  2. Добавьте значение в enum `Strategy` и логику переключения в `getSignalForCandles`.
  3. При необходимости расширьте `TradeConfig`.

- Подключение иного источника данных:
  1. Реализуйте новый адаптер, соответствующий `MarketDataPort` в `core/infrastructure/<provider>/`.
  2. Подайте адаптер в `getSignalForParams` из UI вместо `TBankApiAdapter`.

## Известные ограничения и заметки

- `daysSpan` вычисляется по первой и последней свече текущего набора; если данных нет, отображается «—».
- Точность графика зависит от корректности временных меток `time` (мс) в доменных свечах.
- UI показывает последний рассчитанный сигнал и даёт возможность быстро скрывать/показывать график.
